<!DOCTYPE html>
<html>

<head>
	<title>Sudoku Solver</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width = device-width, initial-scale = 1.0">
	<link rel="stylesheet" href="css/sudoku-solver.css">
		<link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">
</head>

<script type="text/javascript">
var table = new Array(81).fill(0);
var visualization = true;
var running = false;

function readTable(){
  for(var i = 0; i < 81; i++){
    (document.getElementById('cell'+i).value != 0) ? table.push(parseInt(document.getElementById('cell'+i).value)) : table.push(0);
  }
}

function remove(arr, value){
		for(var i = 0; i < arr.length; i++){
			if(arr[i]==value){
				arr.splice(i, 1);
			}
		}
		return arr;
}

function testH(){
	clearTable();
	table.fill(0);
	table[3] = 2;
	table[5] = 5;
	table[8] = 4;
	table[9] = 8;
	table[10] = 4;
	table[13] = 6;
	table[14] = 1;
	table[16] = 2;
	table[17] = 7;
	table[20] = 2;
	table[23] = 4;
	table[25] = 6;
	table[26] = 3;
	table[31] = 3;
	table[32] = 9;
	table[36] = 4;
	table[42] = 3;
	table[45] = 6;
	table[52] = 7;
	table[53] = 8;
	table[54] = 3;
	table[60] = 8;
	table[61] = 4;
	table[63] = 2;
	table[73] = 8;
	table[74] = 1;
	table[77] = 7;
	table[78] = 2;
	table[79] = 3;
	printTable();
}

function test(){
	clearTable();
	table.fill(0);
	table[2] = 4;
	table[3] = 5;
	table[4] = 6;
	table[8] = 3;
	table[9] = 6;
	table[13] = 9;
	table[15] = 4;
	table[16] = 8;
	table[20] = 5;
	table[22] = 2;
	table[25] = 7;
	table[31] = 3;
	table[32] = 9;
	table[37] = 4;
	table[39] = 7;
	table[41] = 8;
	table[42] = 3;
	table[43] = 6;
	table[45] = 9;
	table[48] = 2;
	table[49] = 1;
	table[50] = 6;
	table[54] = 1;
	table[55] = 7;
	table[56] = 9;
	table[65] = 2;
	table[66] = 3;
	table[69] = 8;
	table[74] = 8;
	table[75] = 9;
	table[78] = 6;
	table[79] = 2;
	table[80] = 7;
	printTable();
}

function whiteOut(){
		for (var i = 0; i<81; i++){
			document.getElementById("cell"+i).style.background = "white"
		}
}

function timer(ms) {
 return new Promise(res => setTimeout(res, ms));
}

function doublePair(pos, numbers){
	var values = [];
	var offset = parseInt(pos % 9);
	var line = parseInt(pos/9);
	var newid;
	var possib = [];
	var id;
	console.log(pos);
	console.log(numbers);
	for(let l = 0; l < 3; l++){
		for(let i = 0; i < 9; i++){
			values = [];
			switch (l) {
				case 0:
					//squares
					id = (parseInt(offset/3)*3) + (parseInt(line/3)*27) + (parseInt(i/3)*9) + (i % 3);
				break;
				case 1:
					//rows
					id = line*9+i;
				break;
				case 2:
					// column
					id = (i*9 + offset);
				break;
			}
			//Check the possible values in the same column/row/sqaure
			if(table[id] == 0 && id != pos){
					values = compare(id);
			}
			//possible values is the same in 2 different cells
			if (values.length == 2){
				console.log ("VALUES = "+values+" IN > "+id);
				if (values[0] > values[1]){
					var aux = values[0];
					values[0] = values[1];
					values[1] = aux;
				}
				if (values[0] == numbers[0] && values[1] == numbers[1]){
					console.log ("NUMBERS = "+numbers+" IN > "+pos+" AND VALUES = "+values+" IN > "+id);
					for(let j = 0; j < 9; j++){
						if (j != i){
							possib = [];
							switch (l) {
								case 0:
									//squares
									newid = (parseInt(offset/3)*3) + (parseInt(line/3)*27) + (parseInt(j/3)*9) + (j % 3);
									break;
								case 1:
									//rows
									newid = line*9+j;
									break;
								case 2:
									// column
									newid = (j*9 + offset);
									break;
							}
							if(id == 62){
								console.log("NEWID = "+newid);
							}

							if (table[newid] == 0 && newid != pos){
								console.log("Calling compare " + newid);
								possib = compare(newid)
							}
							if (possib.length == 3){
								for(k = 0; k < numbers.length; k++){
							    try{
							      possib = remove(possib, numbers[k]);
							    }
							    catch{

							    }
							  }
								if (possib.length == 1){
									write(newid, possib[0]);
									return true;
								}
							}
						}
					}
				}
			}
		}
	}
	return false;
}

function compare(pos){
  var numbers = [];
  var free = [1,2,3,4,5,6,7,8,9];
  var offset = parseInt(pos % 9);
  var line = parseInt(pos/9);
	//console.log("PRE FREE: "+free);
	whiteOut();
  for(let i = 0; i < 9; i++){
		// column
		id = (i*9 + offset);
		if(visualization == true){
			document.getElementById("cell"+pos).style.background = "rgba(10, 200, 10, 0.4)"
			if (pos != id){
				document.getElementById("cell"+id).style.background = "rgba(200, 10, 200, 0.4)"
			}
		}
    if(table[id] != 0){
      if (numbers.indexOf(table[id]) === -1)
        numbers.push(table[id]);
    }
		//rows
		id = line*9+i;
		if(visualization == true){
			if (pos != id){
				document.getElementById("cell"+id).style.background = "rgba(0, 0, 256, 0.4)"
			}
		}
    if(table[id] != 0){
      if (numbers.indexOf(table[id]) === -1)
        numbers.push(table[id]);
    }
		//squares
		id = (parseInt(offset/3)*3) + (parseInt(line/3)*27) + (parseInt(i/3)*9) + (i % 3);
		if(visualization == true){
			if (pos != id){
				document.getElementById("cell"+id).style.background = "rgba(0, 200, 200, 0.4)"
			}
		}
    if(table[id] != 0){
      if (numbers.indexOf(table[id]) === -1)
        numbers.push(table[id]);
    }
  }


	//console.log("NUMBERS: "+numbers+"POS: "+pos);
  for(i = 0; i < numbers.length; i++){
    try{
      free = remove(free, numbers[i]);
    }
    catch{

    }
  }
	//console.log("POS FREE:"+free);
  return free;
}

function printTable(){
	for(var i = 0; i < 81; i++){
		if(table[i] != 0)
    	document.getElementById('cell'+i).value = table[i];
  }
  //console.log(table);
}

function write(pos, value){
  table[pos] = value;
	document.getElementById('cell'+pos).value = value;
}

async function solve(){
	free = [];
	if (running == false){
		running = true;
	  table = [];
	  readTable();

		var done = false;
	  changed = true;

	  while(done == false && changed == true){
	    changed = false;
	    done = true;
	    for(let i = 0; i < table.length; i++){
	      if (table[i] == 0){
	        done = false;
					await timer(0200);
					free = compare(i);
					if (free.length == 1){
						write(i, free[0]);
						changed = true;
					}
					if (free.length == 2){
						if (doublePair(i, free) == true){
							changed = true;
						}
					}
	      }
	    }
	  }
	  //printTable();
		running = false;
	}
}

function clearTable(){
	//console.log("Running CLEAR");
	for(var i = 0; i < 81; i++){
		table[i] = '';
  	document.getElementById('cell'+i).value = '';
		document.getElementById("cell"+i).style.background = "rgb(255, 255, 255)"
  }
}

</script>

<body>
	<nav>
		<input type="checkbox" id="check">
		<label for="check">
			<div class="hamb"></div><div class="hamb"></div><div class="hamb"></div>
		</label>
		<ul>
			<li id="first"><a href="index.html">Home Page</a></li>
			<li><a href="about-me.html">About Me</a></li>
			<li><a href="projects.html">Projects</a></li>
		</ul>
	</nav>
	<div class="title">
		<h1>Sudoku Solver</h1>
	</div>
	<div class="sudoku">
			<p>This is just a prototype, it can solve simple sudokus, but can't solve sudokus where
			you don't have a single answer for a cell (for now!), I'll be implementing this in the future</p>
		<table id="grid" class="sudoku-pos">
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell0" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell1" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell2" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell3" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell4" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell5" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell6" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell7" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell8" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');"  id="cell9" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell10" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell11" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell12" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell13" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell14" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell15" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell16" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell17" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell18" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell19" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell20" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell21" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell22" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell23" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell24" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell25" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell26" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell27" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell28" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell29" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell30" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell31" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell32" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell33" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell34" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell35" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell36" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell37" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell38" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell39" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell40" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell41" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell42" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell43" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell44" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell45" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell46" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell47" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell48" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell49" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell50" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell51" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell52" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell53" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell54" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell55" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell56" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell57" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell58" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell59" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell60" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell61" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell62" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell63" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell64" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell65" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell66" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell67" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell68" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell69" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell70" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell71" maxlength="1"></td>
		  </tr>
		  <tr>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell72" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell73" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell74" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell75" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell76" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell77" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell78" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell79" maxlength="1"></td>
		    <td class="cell"><input class="inputs" type="text" oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="cell80" maxlength="1"></td>
		  </tr>
		</table>
		<div class="info">
			<ul>
				<li><div class="color-position"><div class="colors green"></div></div><a>Non-filled cell</a></li>
				<li><div class="color-position"><div class="colors purple"></div></div><a>Row being compared</a></li>
				<li><div class="color-position"><div class="colors pink"></div></div><a>Column being compared</a></li>
				<li><div class="color-position"><div class="colors blue"></div></div><a>Square being compared</a></li>
			</ul>
			<p id="tip">Quick tip: Use TAB to easily go through the cells.</p>
			<div class="buttonlist">
				<input type="button" class="button fbutton" value="Solve!" onclick="solve()">
				<input type="button" class="button" value="Clear" onclick="clearTable()">
				<input type="button" class="button" value="Example Sudoku" onclick="test()">
				<input type="button" class="button" value="Example Hard Sudoku" onclick="testH()">
			</div>
		</div>
	</div>
	<div class="bottom">
		<div class="bottom_title">
			<h1>Contact Me</h1>
		</div>
		<div class="block">
			git-lab:<br><a href="https://gitlab.com/jean.sanchuki" class="link">jean.sanchuki</a><br><br>
			linkedin:<br><a href="https://www.linkedin.com/in/jean-sanch-f/" class="link">jean-sanch-f</a>
		</div>
		<div class="block">
			e-mail:<br>jean.sanchuki@gmail.com
		</div>
	</div>
</body>
</html>
